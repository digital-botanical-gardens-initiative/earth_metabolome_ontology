[PrefixDeclaration]
: https://purl.org/emi/abox#
emi: https://purl.org/emi#
wd: http://www.wikidata.org/entity/
owl: http://www.w3.org/2002/07/owl#
rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns#
sdo: http://schema.org/
xml: http://www.w3.org/XML/1998/namespace
xsd: http://www.w3.org/2001/XMLSchema#
foaf: http://xmlns.com/foaf/0.1/
rdfs: http://www.w3.org/2000/01/rdf-schema#
skos: http://www.w3.org/2004/02/skos/core#
sosa: http://www.w3.org/ns/sosa/
vann: http://purl.org/vocab/vann/
void: http://rdfs.org/ns/void#
orcid: http://orcid.org/
dcterms: http://purl.org/dc/terms/
npc: https://purl.org/npc#
usi: https://metabolomics-usi.ucsd.edu/dashinterface/?usi1=
prov: http://www.w3.org/ns/prov#

[MappingDeclaration] @collection [[
mappingId	canopus_compound_summary
target		:CANOPUS-{usi} a emi:ChemicalTaxonAnnotation ; rdfs:label "The CANOPUS annotation of {usi}"^^xsd:string; emi:hasClass npc:{npc_class}; emi:hasClassProbability {NPC_class_Probability}^^xsd:double; emi:hasSuperClassProbability {NPC_superclass_Probability}^^xsd:double; emi:hasPathwayProbability {NPC_pathway_Probability}^^xsd:double . usi:{usi} emi:hasAnnotation :CANOPUS-{usi} .
source		SELECT DISTINCT CONCAT('mzspec:', m.massive_id, ':', m.sample_id,
 '_features_ms2_', IF(ccs.id LIKE '%pos%', 'pos','neg'),'.mgf:scan:', ccs.featureId) as usi,
 REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(UPPER(REPLACE(NPC_class, ' ', '_')), '(', '%28'),
 ')', '%29'), 'Β','%CE%92'), 'Ε','%CE%95'), 'Ψ' , '%CE%A8' ), 'Γ', '%CE%93'), 'Κ','%CE%9A'), 'Π' ,'%CE%A0' ), 'Χ' ,'%CE%A7')
 as npc_class, NPC_pathway_Probability, NPC_superclass_Probability, NPC_class_Probability, featureId
 FROM canopus_compound_summary as ccs join sample_metadata as m on ccs.sample_id = m.sample_id AND ccs.ionization = m.ionization


mappingId	sample_data_raw_material
target		:{raw_material_id} a emi:RawMaterial; dcterms:identifier {raw_material_id}^^xsd:string; sosa:hasSample :{sample_extract_id} . :{sample_extract_id} a emi:ExtractSample; rdfs:label {sample_extract_label}^^xsd:string;   dcterms:identifier {sample_extract_id}^^xsd:string; sosa:isFeatureOfInterestOf  :{sample_filename_pos} ; sosa:isFeatureOfInterestOf :{sample_filename_neg} . :{sample_filename_pos} a emi:LCMSAnalysisPos ;  rdfs:comment {params_pos}^^xsd:string ; emi:hasGNPSLCMSLink "https://dashboard.gnps2.org/?usi=mzspec:{massive_id}:{sample_filename_pos}"^^xsd:anyURI; foaf:depiction <https://dashboard.gnps2.org/mspreview?usi=mzspec:{massive_id}:{sample_filename_pos}> ; emi:hasMassiveDOI <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}>. :{sample_filename_neg} a emi:LCMSAnalysisNeg;  rdfs:comment {params_neg}^^xsd:string; emi:hasGNPSLCMSLink "https://dashboard.gnps2.org/?usi=mzspec:{massive_id}:{sample_filename_neg}"^^xsd:anyURI; foaf:depiction <https://dashboard.gnps2.org/mspreview?usi=mzspec:{massive_id}:{sample_filename_neg}>; emi:hasMassiveDOI <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}>. <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}> dcterms:license <https://creativecommons.org/publicdomain/zero/1.0/> . 
source		SELECT DISTINCT source_id as raw_material_id, source_taxon as taxon_label, sample_id as sample_extract_id, CONCAT('Sample ', sample_id) as sample_extract_label,sample_filename_pos, sample_filename_neg, CONCAT(sample_id,'_lcms_processing_params_', ionization, '.xml' ) as processing_params_file, massive_id,CASE WHEN ionization = 'pos' THEN lcms_method_params  END as params_pos, CASE WHEN ionization = 'neg' THEN lcms_method_params  END as params_neg   FROM sample_metadata WHERE sample_type = 'sample'

mappingId	sample_data_blank
target		:{sample_id} a emi:Blank; rdfs:label {blank_label}^^xsd:string;   dcterms:identifier {sample_id}^^xsd:string; sosa:isFeatureOfInterestOf  :{sample_filename_pos} ; sosa:isFeatureOfInterestOf :{sample_filename_neg} . :{sample_filename_pos} a emi:LCMSAnalysisPos ;  rdfs:comment {params_pos}^^xsd:string ; emi:hasMassiveDOI <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}> . :{sample_filename_neg} a emi:LCMSAnalysisNeg; rdfs:comment {params_neg}^^xsd:string; emi:hasMassiveDOI <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}>. <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}> dcterms:license <https://creativecommons.org/publicdomain/zero/1.0/> . 
source		SELECT DISTINCT sample_id, CONCAT('Blank ', sample_id) as blank_label,sample_filename_pos, sample_filename_neg, massive_id,CASE WHEN ionization = 'pos' THEN lcms_method_params  END as params_pos, CASE WHEN ionization = 'neg' THEN lcms_method_params  END as params_neg  FROM sample_metadata WHERE sample_type = 'blank'

mappingId	sample_data_qc
target		:{sample_id} a emi:QCSample; rdfs:label {blank_label}^^xsd:string;   dcterms:identifier {sample_id}^^xsd:string; sosa:isFeatureOfInterestOf  :{sample_filename_pos} ; sosa:isFeatureOfInterestOf :{sample_filename_neg} . :{sample_filename_pos} a emi:LCMSAnalysisPos ;  rdfs:comment {params_pos}^^xsd:string ; emi:hasMassiveDOI <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}> . :{sample_filename_neg} a emi:LCMSAnalysisNeg ; rdfs:comment {params_neg}^^xsd:string; emi:hasMassiveDOI <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}>. <https://massive.ucsd.edu/ProteoSAFe/dataset.jsp?accession={massive_id}> dcterms:license <https://creativecommons.org/publicdomain/zero/1.0/> . 
source		SELECT DISTINCT sample_id, CONCAT('Quality control sample ', sample_id) as blank_label,sample_filename_pos, sample_filename_neg, massive_id,CASE WHEN ionization = 'pos' THEN lcms_method_params  END as params_pos, CASE WHEN ionization = 'neg' THEN lcms_method_params  END as params_neg  FROM sample_metadata WHERE sample_type = 'qc'

mappingId	taxon_metadata
target	 	:{source_id} sosa:isSampleOf _:ORGANISM-{wd_id} . _:ORGANISM-{wd_id} a emi:Organism ; emi:inTaxon <{wd_value}>. <{wd_value}> rdfs:label {source_taxon}^^xsd:string; dcterms:identifier {wd_id}^^xsd:string .
source		SELECT  DISTINCT source_id, wd_value, source_taxon, REPLACE(wd_value, 'http://www.wikidata.org/entity/', '') as wd_id FROM taxon_metadata 

mappingId	features_quant
target	 	:{sample_filename} emi:hasLCMSFeatureSet :{sample_id}_lcms_feature_list_{ionization} . :{sample_id}_lcms_feature_list_{ionization} a emi:LCMSFeatureSet ; rdfs:label "{ionization} LCMS feature set of {sample_id}"^^xsd:string ; rdfs:comment "The LCMS feature list in {ionization} ionization mode of {sample_id}"^^xsd:double; emi:hasLCMSFeature usi:mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{row_ID} . usi:mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{row_ID} a emi:LCMSFeature; rdfs:label "{ionization} LCMS feature {row_ID} of {sample_id}"^^xsd:string ; rdfs:comment "The LCMS feature {row_ID} of LCMS feature list in {ionization} ionization mode of {sample_id}"^^xsd:string ; emi:hasRowId {row_ID}^^xsd:integer; emi:hasRetentionTime {row_retention_time}^^xsd:double; emi:hasFeatureArea {peak_area}^^xsd:double; emi:hasRelativeFeatureArea {relative_area}^^xsd:double; emi:hasParentMass {row_mz}^^xsd:double; emi:hasUSI  "mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{row_ID}"^^xsd:string ; rdfs:seeAlso <https://fasst.gnps2.org/fastsearch/?usi1=mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{row_ID}> ; foaf:depiction <https://metabolomics-usi.gnps2.org/png/?usi1=mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{row_ID}> .
source		SELECT  DISTINCT f.sample_id, f.ionization, massive_id, row_ID, row_retention_time, peak_area, row_mz, (peak_area/max_area) as relative_area, CASE WHEN f.ionization = 'pos' THEN sample_filename_pos WHEN f.ionization = 'neg' THEN sample_filename_neg END  as sample_filename FROM features_quant as f join sample_metadata as m ON m.sample_id = f.sample_id AND m.ionization = f.ionization JOIN (SELECT sample_id, ionization, MAX(peak_area) as max_area  FROM  features_quant GROUP BY sample_id, ionization ) as max_table ON max_table.sample_id = f.sample_id and max_table.ionization = f.ionization WHERE sample_type = 'sample'


mappingId	compound_identifications
target	 	usi:mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} emi:hasAnnotation :sirius_mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} . :sirius_mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} a emi:StructuralAnnotation; prov:wasGeneratedBy :SIRIUS-ANNOTATOR-{sample_filename} ; emi:hasInChIKey2D :{InChIkey2D}; rdfs:label "SIRIUS annotation of {ionization} LCMS feature {featureId} of {sample_id}"^^xsd:string ; rdfs:comment "The SIRIUS tool annotation of mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} (a LCMS feature identifier)"^^xsd:string ; emi:hasAdduct {adduct}^^xsd:string; emi:hasCosmicScore {ConfidenceScore}^^xsd:double; emi:hasZodiacScore {ZodiacScore}^^xsd:double; emi:hasScore {SiriusScore}^^xsd:double . :{InChIkey2D} a emi:InChIKey2D . :SIRIUS-ANNOTATOR-{sample_filename} prov:used :SIRIUS-PARAMETERS-{sample_filename}; prov:wasAssociatedWith <https://bio.informatik.uni-jena.de/software/sirius> . :SIRIUS-PARAMETERS-{sample_filename} rdfs:label "/{sample_id}/{ionization}/{sample_id}_WORKSPACE_SIRIUS/params.yml"^^xsd:string.    
source		SELECT DISTINCT massive_id, featureId, c.ionization, c.sample_id, InChIkey2D, adduct, SiriusScore, ZodiacScore, ConfidenceScore, IF(c.ionization = 'pos', sample_filename_pos,  sample_filename_neg) as sample_filename  FROM compound_identifications c JOIN sample_metadata m ON m.ionization = c.ionization AND m.sample_id = c.sample_id

mappingId	isdb_reweighted_flat
target	 	usi:mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} emi:hasAnnotation :isdb_mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} . :isdb_mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} a emi:StructuralAnnotation; prov:wasGeneratedBy :ISDB-ANNOTATOR-{sample_filename} ; emi:hasInChIKey2D :{short_inchikey}; rdfs:label "ISDB annotation of {ionization} LCMS feature {featureId} of {sample_id}"^^xsd:string ; rdfs:comment "The ISDB annotation of mzspec:{massive_id}:{sample_id}_features_ms2_{ionization}.mgf:scan:{featureId} (a LCMS feature identifier)"^^xsd:string ; emi:hasAdduct {adduct}^^xsd:string; emi:hasConsistencyScore {score_max_consistency}^^xsd:integer; emi:hasSpectralScore {score_input}^^xsd:double; emi:hasFinalScore {final_score}^^xsd:double ; emi:hasTaxoScore {score_taxo}^^xsd:integer. :{short_inchikey} a emi:InChIKey2D . :ISDB-ANNOTATOR-{sample_filename} prov:used :ISDB-PARAMETERS-{sample_filename}; prov:wasAssociatedWith <https://oolonek.github.io/ISDB> . :ISDB-PARAMETERS-{sample_filename} rdfs:label "/{sample_id}/{ionization}/isdb/config.yaml"^^xsd:string.    
source		SELECT DISTINCT massive_id, featureId, c.ionization, c.sample_id, short_inchikey, score_input, score_taxo, score_max_consistency, final_score, adduct, IF(c.ionization = 'pos', sample_filename_pos,  sample_filename_neg) as sample_filename FROM emi_db.isdb_reweighted_flat c JOIN sample_metadata m ON m.ionization = c.ionization AND m.sample_id = c.sample_id


]]

